import{Q as z,a as b,b as A,c as x}from"./QTabPanels-zWNV00mi.js";import{ad as D,u as G,r as s,o as K,k as L,l as j,m as t,f as a,n as r,Q as M,t as V,ah as Z,x as B,a0 as _,Z as w,_ as U,af as H,ag as J,v as W,y as E,a4 as X}from"./index-DD84rciS.js";import{Q as O}from"./QTable-B6mhboVn.js";import{Q as R}from"./QSelect-D9KbhcM8.js";import{a as T}from"./QItemLabel-Y1e7J-9n.js";import{Q as Y}from"./QPage-BB2Um8dJ.js";import{api as g}from"./axios-DO-4OFiN.js";import{_ as ee}from"./EncabezadoParametros-Hnd7hUHE.js";import{U as u}from"./Utils-DJ7xQ2GR.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QResizeObserver-u-GIezmO.js";import"./touch-BjYP5sR0.js";import"./QVirtualScroll-DljW3BAz.js";import"./QList-BWY4JASi.js";import"./QMarkupTable-DvZ2xV1r.js";import"./format-DyQxkAtJ.js";import"./use-quasar-CoRWwBkt.js";const oe={class:"row q-pa-sm"},le={class:"full-width row q-pa-md q-pt-md q-pb-md br-circle"},se={class:"q-gutter-sm"},te={class:"row col-12 q-gutter-sm"},re={class:"row q-col-gutter-md"},ne={__name:"AsignacionOrdenes",setup(ie){D();const k=G(),h=s(!0),c=s("asignar"),y=s([]),I=s([]),Q=s(!1),i=s([]),C=s(!1),n=s({}),d=s({texto:"",fechaInicio:"",fechaFin:""}),F=[{name:"CodigoRadicado",align:"center",label:"Código PQRS",field:"CodigoRadicado",sortable:!0},{name:"Usuario",align:"center",label:"Usuario",field:"Usuario",sortable:!0},{name:"FechaCFechaRadicadoreacion",align:"center",label:"Fecha",field:"FechaRadicado",format:l=>u.formatearFecha(l)},{name:"Telefono",align:"center",label:"Teléfono",field:"Telefono"},{name:"Barrio",align:"center",label:"Barrio",field:"Barrio"},{name:"Direccion",align:"center",label:"Dirección",field:"Direccion"},{name:"CreadorOrden",align:"center",label:"Creador Orden",field:"CreadorOrden"}];s(!1),s(!1),s(null),s([]);const P=s([]),v=s([]),m=s(null),p=s(null);s(!1),s(null);const q=async l=>{if(!l){v.value=[];return}try{const e=await u.peticion("GET",`usuario/${l}/${n.value.IdEmpresa}/usuario-por-cargo`);v.value=e.data||[]}catch(e){console.error("Error al filtrar usuarios por cargo:",e)}},N=async()=>{const l=await g.get(`/ordenservicio/${n.value.IdEmpresa}/traer-cargos-empresa`);P.value=l.data},S=async()=>{const l=[];console.log(i.value),i.value.forEach(o=>{l.push({IdPqrs:o.IdPqrs,IdUsuarioA:n.value.IdUsuario,IdUsuario:p.value})}),console.log(l);const e=await g.post("/ordenservicio/asignar-tecnicos-orden",l);u.notificacion("Se asginaron ordenes",e.data.IsExito),u.loadingNotify(!1,""),f(),m.value="",p.value=""},f=async()=>{console.log(n.value);const l=await g.get(`/ordenservicio/${n.value.IdEmpresa}/1/traer-ordenes-empresa-estado`);y.value=l.data,console.log()},$=async()=>{console.log(n.value);const l=await g.get(`/ordenservicio/${n.value.IdEmpresa}/3/traer-ordenes-empresa-estado`);I.value=l.data,console.log()};return K(async()=>{try{const l=await u.datoUsuario();if(!l){k.push("/Login");return}n.value=l}catch(l){console.error(l)}f(),$(),N()}),(l,e)=>(j(),L(Y,{style:{height:"calc(100vh - 55px)",overflow:"auto","background-color":"#EBEBF0"}},{default:t(()=>[a(ee,{parteUno:"Gestión",parteDos:"Órdenes"},{botones:t(()=>[...e[10]||(e[10]=[])]),_:1}),r("section",oe,[r("main",le,[a(M,{class:"full-width"},{default:t(()=>[a(z,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=o=>c.value=o),dense:"",class:"bg-grey-4 text-white-7","active-color":"primary","indicator-color":"black",align:"justify"},{default:t(()=>[a(b,{name:"asignar",label:"Asignar Órdenes"}),a(b,{name:"verificacion",label:"Ordenes Pendientes"}),a(b,{name:"finalizadas",label:"Órdenes Finalizadas"})]),_:1},8,["modelValue"]),a(A,{modelValue:c.value,"onUpdate:modelValue":e[8]||(e[8]=o=>c.value=o),animated:""},{default:t(()=>[a(x,{name:"asignar"},{default:t(()=>[e[12]||(e[12]=r("p",{class:"text-center text-h5"},"Asignar Orden",-1)),r("div",se,[r("div",te,[a(V,{modelValue:d.value.texto,"onUpdate:modelValue":e[1]||(e[1]=o=>d.value.texto=o),filled:"",label:"Buscar por número o usuario",class:"col-xs-12 col-sm-6 col-md-5 col-lg",onKeyup:Z(f,["enter"])},null,8,["modelValue"]),a(V,{modelValue:d.value.fechaInicio,"onUpdate:modelValue":e[2]||(e[2]=o=>d.value.fechaInicio=o),filled:"",type:"date",label:"Fecha Inicio",class:"col-xs-12 col-sm-6 col-md-3 col-lg"},null,8,["modelValue"]),a(V,{modelValue:d.value.fechaFin,"onUpdate:modelValue":e[3]||(e[3]=o=>d.value.fechaFin=o),filled:"",type:"date",label:"Fecha Fin",class:"col-xs-12 col-sm-6 col-md-3 col-lg"},null,8,["modelValue"]),a(B,{color:"primary",label:"Buscar",icon:"search",onClick:f,class:"col-xs-12 col-sm-2"})]),a(O,{flat:"",bordered:"",title:"Órdenes",rows:y.value,columns:F,"row-key":"CodigoRadicado",selection:"multiple",selected:i.value,"onUpdate:selected":e[4]||(e[4]=o=>i.value=o),loading:C.value,"no-data-label":"No se encontraron órdenes"},null,8,["rows","selected","loading"]),r("div",re,[a(R,{modelValue:m.value,"onUpdate:modelValue":[e[5]||(e[5]=o=>m.value=o),q],options:P.value,"option-label":"Nombre","option-value":"IdRol",label:"Cargo",clearable:"","emit-value":"","map-options":"",class:"col-6"},null,8,["modelValue","options"]),a(R,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=o=>p.value=o),options:v.value,"option-label":"NombreCompleto","option-value":"IdUsuario",label:"Usuario","use-input":"","emit-value":"","map-options":"",clearable:"",class:"col-6",disable:!m.value,onFilter:l.filtrarUsuarios},{option:t(o=>[a(_,H(J(o.itemProps)),{default:t(()=>[a(w,{avatar:""},{default:t(()=>[a(W,{name:"person"})]),_:1}),a(w,null,{default:t(()=>[a(T,null,{default:t(()=>[U(E(o.opt.NombreCompleto),1)]),_:2},1024),a(T,{caption:""},{default:t(()=>[U(E(o.opt.Identificacion),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":t(()=>[a(_,null,{default:t(()=>[a(w,{class:"text-grey-10"},{default:t(()=>[...e[11]||(e[11]=[U("Sin resultados",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","options","disable","onFilter"])]),a(B,{onClick:S,label:"Asignar ordenes",color:"black"})])]),_:1}),a(x,{name:"verificacion"},{default:t(()=>[e[13]||(e[13]=r("p",{class:"text-center text-h5"},"Ordenes Pendientes",-1)),a(O,{flat:"",bordered:"",title:"Órdenes",rows:I.value,columns:F,"row-key":"CodigoRadicado",selection:"multiple",selected:i.value,"onUpdate:selected":e[7]||(e[7]=o=>i.value=o),loading:C.value,"no-data-label":"No se encontraron órdenes"},null,8,["rows","selected","loading"])]),_:1}),a(x,{name:"finalizadas"},{default:t(()=>[...e[14]||(e[14]=[r("p",{class:"text-center text-h5"},"Órdenes finalizadas",-1),r("p",{class:"text-h6 text-grey"},"Próximamente",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})])]),a(X,{modelValue:Q.value,"onUpdate:modelValue":e[9]||(e[9]=o=>Q.value=o),"full-width":"",maximized:h.value,persistent:""},null,8,["modelValue","maximized"])]),_:1}))}},Fe=ae(ne,[["__scopeId","data-v-92cdc2d3"]]);export{Fe as default};
