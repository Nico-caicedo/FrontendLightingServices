import{r as u,c as ve,o as W,V as pe,l as x,n as V,f as a,_ as m,v as X,x as b,t as g,m as l,S as U,k as E,a0 as k,Z as P,Q as M,p as L,y as O,ab as ge,a4 as j,ac as B,ad as be,u as ye,q as Ce,ae as Ve,af as Ie,ag as we,z as w}from"./index-DD84rciS.js";import{Q as xe,a as $}from"./QItemLabel-Y1e7J-9n.js";import{Q as A}from"./QTooltip-D3K5a0T4.js";import{Q as G}from"./QSelect-D9KbhcM8.js";import{Q as Te}from"./QForm-DwmnhYBt.js";import{Q as J,a as K}from"./QToolbar-CvcB6vS-.js";import{Q as Qe}from"./QPage-BB2Um8dJ.js";import{C as S}from"./ClosePopup-CT1KP1o0.js";import{api as D}from"./axios-DO-4OFiN.js";import{U as n}from"./Utils-DJ7xQ2GR.js";import{_ as qe}from"./EncabezadoParametros-Hnd7hUHE.js";import{_ as Ee}from"./FormTercero-C-LO8pTD.js";import{Q as Pe}from"./QList-BWY4JASi.js";import{Q as De}from"./QTd-Bq4iPcoX.js";import{Q as Re}from"./QTable-B6mhboVn.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./format-DyQxkAtJ.js";import"./use-quasar-CoRWwBkt.js";import"./QVirtualScroll-DljW3BAz.js";import"./QMarkupTable-DvZ2xV1r.js";const ke={class:"q-gutter-md"},Se={class:"text-h5 text-black text-weight-bold q-mb-md flex items-center justify-between"},_e={__name:"Tramites",emits:["editar-pqrs"],setup(Y,{emit:z}){const f=u([]),t=u(!1),d=u(""),I=u(!1),y=u(null),T=u({}),Q=[{name:"Numero",label:"Número PQRS",field:"CodigoRadicado",align:"center",sortable:!0},{name:"CodigoDocumento",label:"Código Documento",field:"CodigoDocumento",align:"center",sortable:!0},{name:"Fecha",label:"Fecha",field:"FechaRadicado",align:"center",sortable:!0,format:i=>n.formatearFecha(i)},{name:"Tercero",label:"Creador Orden",field:"CreadorOrden",align:"center"},{name:"Estado",label:"Estado",field:"EstadoSolicitud",align:"center",format:i=>{switch(i){case 1:return"Sin Asignar";case 2:return"Por Validar";case 3:return"Asignado";case 4:return"Terminado";default:return"Desconocido"}}},{name:"acciones",label:"Acciones",align:"center"}],_=ve(()=>{if(!d.value)return f.value;const i=d.value.toLowerCase();return f.value.filter(s=>{var c,C;return((c=s.CodigoRadicado)==null?void 0:c.toLowerCase().includes(i))||((C=s.CreadorOrden)==null?void 0:C.toLowerCase().includes(i))})}),N=async()=>{t.value=!0;try{const i=await D.get(`ordenservicio/${T.value.IdEmpresa}/traer-todo-ordenes-empresa`);f.value=i.data}catch{B.create({message:"Error al cargar PQRS",color:"negative",icon:"error"})}finally{t.value=!1}},p=z,F=i=>{y.value=i,p("editar-pqrs",i),B.create({message:`PQRS ${i.CodigoRadicado} cargada para edición`,color:"green",icon:"edit"})},q=i=>{y.value=i,I.value=!0},R=async()=>{try{await D.delete(`/pqrs/eliminar/${y.value.IdPqrs}`),B.create({message:"PQRS eliminada correctamente",color:"positive",icon:"check"}),f.value=f.value.filter(i=>i.IdPqrs!==y.value.IdPqrs)}catch{B.create({message:"Error al eliminar PQRS",color:"negative",icon:"error"})}finally{I.value=!1}};return W(async()=>{try{const i=await n.datoUsuario();if(!i){router.push("/Login");return}T.value=i,N()}catch(i){console.error(i)}}),(i,s)=>(x(),pe("div",ke,[V("div",Se,[V("div",null,[a(X,{name:"assignment",class:"q-mr-sm"}),s[2]||(s[2]=m(" Gestor de PQRS / Órdenes ",-1))]),a(b,{color:"black",label:"Actualizar",icon:"refresh",onClick:N})]),a(g,{dense:"",outlined:"",debounce:"300",modelValue:d.value,"onUpdate:modelValue":s[0]||(s[0]=c=>d.value=c),placeholder:"Buscar por número, técnico o estado...",clearable:"","prepend-inner-icon":"search",class:"bg-white"},null,8,["modelValue"]),a(Re,{rows:_.value,columns:Q,"row-key":"IdPqrs",flat:"",bordered:"",dense:"",loading:t.value,"no-data-label":"No hay registros disponibles",separator:"cell"},{"body-cell-acciones":l(c=>[a(De,{align:"center"},{default:l(()=>[a(b,{flat:"",round:"",dense:"",icon:"view_headline"},{default:l(()=>[a(xe,null,{default:l(()=>[a(Pe,{style:{"min-width":"150px"},separator:""},{default:l(()=>[U((x(),E(k,{clickable:"",onClick:C=>F(c.row)},{default:l(()=>[a(P,null,{default:l(()=>[a($,null,{default:l(()=>[...s[3]||(s[3]=[m("Editar",-1)])]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[S]]),U((x(),E(k,{clickable:"",onClick:C=>q(c.row)},{default:l(()=>[a(P,null,{default:l(()=>[a($,null,{default:l(()=>[...s[4]||(s[4]=[m("Eliminar",-1)])]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[S]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["rows","loading"]),a(j,{modelValue:I.value,"onUpdate:modelValue":s[1]||(s[1]=c=>I.value=c)},{default:l(()=>[a(M,{class:"q-pa-md"},{default:l(()=>[a(L,null,{default:l(()=>{var c;return[s[7]||(s[7]=V("div",{class:"text-h6"},"Confirmar eliminación",-1)),V("div",null,[s[5]||(s[5]=m("¿Deseas eliminar esta PQRS: ",-1)),V("b",null,O((c=y.value)==null?void 0:c.Numero),1),s[6]||(s[6]=m("?",-1))])]}),_:1}),a(ge,{align:"right"},{default:l(()=>[U(a(b,{flat:"",label:"Cancelar",color:"grey"},null,512),[[S]]),a(b,{flat:"",label:"Eliminar",color:"negative",onClick:R})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Ne=Ue(_e,[["__scopeId","data-v-6328fc2b"]]),Fe={class:"row q-pa-sm"},Be={class:"full-width row q-pa-md q-pt-md q-pb-md br-circle"},Ae={class:"items-center q-pa-sm bg-grey-2 rounded-borders"},$e={class:"col-xs-12 q-mt-md"},sa={__name:"CrearTramite",setup(Y){be();const z=ye(),f=u({}),t=u({}),d=u(""),I=u({}),y=u(!1),T=u(!1),Q=u([]);u(""),u(""),u("");const _=u(""),N=u(!1),p=u(!1),F=u(!1),q=u(!1),R=u(null),i=u([{label:"Urbano",value:"Urbano"},{label:"Rural",value:"Rural"}]),s=u(!1),c=u([]),C=u([...c.value]),h=(r,e)=>{if(r===""){e(()=>{C.value=[...c.value]});return}e(()=>{const o=r.toLowerCase();C.value=c.value.filter(v=>v.NombreBarrio.toLowerCase().includes(o))})},ee=async()=>{try{n.loadingNotify(!0,"Cargando barrios...");const r=await D.get("/ordenservicio/traer-barrios");c.value=r.data,C.value=[...c.value]}catch(r){console.error("Error al cargar barrios:",r),n.notificacion("Error al cargar los barrios",!1)}finally{n.loadingNotify(!1)}},H=()=>{t.value={},d.value="",N.value=!1,q.value=!1,F.value=!1,p.value=!1,s.value=!1,t.value.FechaRadicado=n.fechaHoy()},ae=()=>{I.value={},y.value=!0},le=r=>{y.value=!1,n.notificacion(r.Mensaje,r.IsExito)},oe=r=>{q.value=!0,T.value=!1,console.log("Antes:",r),s.value=!1,p.value=!1;const e={...r};console.log("COPIA:",e),ue(e.Identificacion),e.FechaRadicado=n.darFormatoDate(e.FechaRadicado),console.log("Después:",e),e.IsInterno&&(s.value=e.IsInterno,p.value=!0),t.value=e},re=()=>{T.value=!0},te=async()=>{if(!R.value)return;const r=await R.value.validate();r&&!q.value?de():r&&q.value&&ce()},se=()=>{d.value=""},Z=r=>{d.value=r},ne=()=>{s.value?(d.value="",p.value=!0,d.value=_.value):(p.value=!1,d.value="")},ie=async(r,e)=>{if(!(!r||r.trim()===""))try{const o=await n.peticion("GET",`tercero/${f.value.IdEmpresa}/empresa/${r}/filtro`);e(()=>{var v;Q.value=((v=o.data)==null?void 0:v.Dato)||[]})}catch(o){console.error("Error al filtrar:",o)}},ue=async r=>{var v;const e=await n.peticion("GET",`tercero/${f.value.IdEmpresa}/empresa/${r}/filtro`);Q.value=(v=e.data)==null?void 0:v.Dato,Q.value.find(fe=>fe.Identificacion==r)?Z(Q.value[0]):console.log("no se encontro")},de=async()=>{try{t.value.CodigoDocumento="",t.value.CodigoRadicado="",t.value.IdUsuarioC=f.value.IdUsuario,t.value.IdEmpresa=f.value.IdEmpresa,t.value.IsInterno=s.value,t.value.IdTercero=d.value.IdTercero,console.log(t.value),n.loadingNotify(!0,"Generando orden...");const r=await D.post("/ordenservicio/crear-orden-servicio",t.value);console.log(r),n.notificacion(r.data.Mensaje,r.data.IsExito),H()}catch{n.notificacion("Error en la conexión",!1)}finally{n.loadingNotify(!1)}},ce=async()=>{t.value.IdUsuarioA=f.value.IdUsuario,t.value.IdTercero=d.value.IdTercero,n.loadingNotify(!0,"Guardando Cambios...");const r=await D.post("/ordenservicio/guardar-cambios-orden",t.value);console.log(r),n.loadingNotify(!1,""),n.notificacion(r.data.Mensaje,r.data.IsExito)},me=async()=>{const r=await D.post(`/tercero/${f.value.IdEmpresa}/traer-tercero-empresa`,t.value);_.value=r.data};return W(async()=>{try{const r=await n.datoUsuario();if(!r){z.push("/Login");return}f.value=r}catch(r){console.error(r)}me(),await ee(),t.value.FechaRadicado=n.fechaHoy()}),(r,e)=>(x(),E(Qe,{style:{height:"calc(100vh - 55px)",overflow:"auto","background-color":"#EBEBF0"}},{default:l(()=>[a(qe,{parteUno:"Crear",parteDos:"Tramite"},{botones:l(()=>[a(b,{flat:"",icon:"description",color:"grey-7",onClick:re,title:"Agregar Tercero"})]),_:1}),V("section",Fe,[V("main",Be,[a(Te,{ref_key:"formRef",ref:R,onSubmit:Ce(te,["prevent","stop"]),onReset:H,class:"row col-12 q-col-gutter-md"},{default:l(()=>[a(g,{flat:"",outlined:"",modelValue:t.value.CodigoRadicado,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.CodigoRadicado=o),label:"PQRS No.",class:"col-xs-12 col-sm-3 col-md-3 col-lg-3",readonly:""},null,8,["modelValue"]),a(g,{flat:"",outlined:"",modelValue:t.value.CodigoDocumento,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.CodigoDocumento=o),label:"Código Documento",class:"col-xs-12 col-sm-3 col-md-3 col-lg-3",readonly:""},null,8,["modelValue"]),a(g,{outlined:"",modelValue:t.value.FechaRadicado,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.FechaRadicado=o),flat:"",type:"date",readonly:"",class:"col-xs-12 col-sm-6 col-md-6 col-lg-6",label:"Fecha Radicado"},null,8,["modelValue"]),a(G,{flat:"",outlined:"",ref:"EmpleadoRef",clearable:"",onClear:se,"onUpdate:modelValue":[Z,e[4]||(e[4]=o=>d.value=o)],class:"col-md-6 col-sm-12 col-xs-12 col-lg-6","hide-bottom-space":"",modelValue:d.value,color:"grey","option-label":"NombreCompleto","use-input":"","emit-value":"","map-options":"",label:"Tercero",disable:p.value,options:Q.value,onFilter:ie},{option:l(o=>[a(k,Ie(we(o.itemProps)),{default:l(()=>[a(P,{avatar:""},{default:l(()=>[a(X,{name:"person"})]),_:1}),a(P,null,{default:l(()=>[a($,{class:"text-body1"},{default:l(()=>{var v;return[m(O(((v=o.opt)==null?void 0:v.NombreCompleto)||"Sin nombre"),1)]}),_:2},1024),a($,{caption:""},{default:l(()=>{var v;return[m(O(((v=o.opt)==null?void 0:v.Identificacion)||"---"),1)]}),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":l(()=>[a(k,null,{default:l(()=>[a(P,{class:"text-grey-10"},{default:l(()=>[...e[16]||(e[16]=[m("Sin resultados",-1)])]),_:1})]),_:1})]),after:l(()=>[V("div",Ae,[a(b,{flat:"",round:"",dense:"",icon:"group_add",color:"primary",onClick:ae,disable:p.value},{default:l(()=>[a(A,{class:"bg-black",offset:[10,10]},{default:l(()=>[...e[17]||(e[17]=[m(" Agregar Tercero ",-1)])]),_:1})]),_:1},8,["disable"]),a(Ve,{disable:F.value,modelValue:s.value,"onUpdate:modelValue":[e[3]||(e[3]=o=>s.value=o),ne],label:"Interna",color:"primary",size:"sm",class:"text-caption q-mt-xs","left-label":""},{default:l(()=>[a(A,{class:"bg-black",offset:[10,10]},{default:l(()=>[...e[18]||(e[18]=[m(" Petición Interna ",-1)])]),_:1})]),_:1},8,["disable","modelValue"])])]),_:1},8,["modelValue","disable","options"]),a(g,{flat:"",outlined:"",disable:p.value,modelValue:d.value.Identificacion,"onUpdate:modelValue":e[5]||(e[5]=o=>d.value.Identificacion=o),class:"col-xs-12 col-sm-6 col-md-6 col-lg-6",label:"No. Identidad",rules:[w(n).regla],"lazy-rules":""},null,8,["disable","modelValue","rules"]),a(g,{flat:"",outlined:"",disable:p.value,modelValue:d.value.Telefono,"onUpdate:modelValue":e[6]||(e[6]=o=>d.value.Telefono=o),class:"col-xs-12 col-sm-6 col-md-6 col-lg-6",label:"Celular"},null,8,["disable","modelValue"]),a(G,{flat:"",outlined:"",modelValue:t.value.Sector,"onUpdate:modelValue":e[7]||(e[7]=o=>t.value.Sector=o),"lazy-rules":"",rules:[w(n).reglaSelect],class:"col-xs-12 col-sm-6 col-md-6 col-lg-6",options:i.value,"option-value":"value",label:"Tipo Zona","emit-value":"","map-options":"","option-label":"label"},null,8,["modelValue","rules","options"]),a(g,{flat:"",outlined:"",modelValue:t.value.MedioPeticion,"onUpdate:modelValue":e[8]||(e[8]=o=>t.value.MedioPeticion=o),rules:[w(n).regla],"lazy-rules":"",class:"col-xs-12 col-sm-6 col-md-6 col-lg-6",label:"Medio de presentación"},null,8,["modelValue","rules"]),a(G,{flat:"",outlined:"",class:"col-xs-12 col-sm-6 col-md-6 col-lg-6",modelValue:t.value.IdBarrio,"onUpdate:modelValue":e[9]||(e[9]=o=>t.value.IdBarrio=o),"use-input":"","hide-selected":"","fill-input":"","input-debounce":"300",options:C.value,"option-label":"NombreBarrio","option-value":"IdBarrio","emit-value":"","map-options":"",label:"Barrio o corregimiento",onFilter:h,"lazy-rules":"",rules:[w(n).reglaSelect]},{"no-option":l(()=>[a(k,null,{default:l(()=>[a(P,{class:"text-grey"},{default:l(()=>[...e[19]||(e[19]=[m(" Sin resultados ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","options","rules"]),a(g,{flat:"",outlined:"",modelValue:t.value.Direccion,"onUpdate:modelValue":e[10]||(e[10]=o=>t.value.Direccion=o),rules:[w(n).regla],"lazy-rules":"",class:"col-xs-12 col-sm-6 col-md-6 col-lg-6",label:"Dirección "},null,8,["modelValue","rules"]),a(g,{flat:"",outlined:"",disable:p.value,rules:[w(n).regla],"lazy-rules":"",modelValue:d.value.Correo,"onUpdate:modelValue":e[11]||(e[11]=o=>d.value.Correo=o),class:"col-xs-12 col-sm-6 col-md-6 col-lg-6",label:"Correo"},null,8,["disable","rules","modelValue"]),a(g,{flat:"",outlined:"",modelValue:t.value.TipoDano,"onUpdate:modelValue":e[12]||(e[12]=o=>t.value.TipoDano=o),"lazy-rules":"",class:"col-xs-12 col-sm-6 col-md-12 col-lg",label:"Tipo de daño de alumbrado público",rules:[w(n).regla]},null,8,["modelValue","rules"]),a(g,{modelValue:t.value.Observacion,"onUpdate:modelValue":e[13]||(e[13]=o=>t.value.Observacion=o),flat:"",outlined:"",type:"textarea",rules:[w(n).regla],"lazy-rules":"",label:"Observación Usuario",class:"col-12"},null,8,["modelValue","rules"]),V("div",$e,[q.value?(x(),E(b,{key:1,label:"Guardar Cambios",type:"submit",color:"black",class:"q-mr-sm"})):(x(),E(b,{key:0,label:"Generar orden",type:"submit",color:"black",class:"q-mr-sm"})),a(b,{label:"Cancelar",type:"reset",color:"grey"})])]),_:1},512),a(j,{modelValue:y.value,"onUpdate:modelValue":e[14]||(e[14]=o=>y.value=o)},{default:l(()=>[a(M,{style:{width:"800px","max-width":"90vw"}},{default:l(()=>[a(J,{class:"bg-blue-grey-9 text-white"},{default:l(()=>[a(K,null,{default:l(()=>[...e[20]||(e[20]=[m(" Agregar Tercero ",-1)])]),_:1}),U((x(),E(b,{flat:"",icon:"close"},{default:l(()=>[a(A,{"content-class":"bg-white text-primary"},{default:l(()=>[...e[21]||(e[21]=[m("Cerrar",-1)])]),_:1})]),_:1})),[[S]])]),_:1}),a(L,{class:"q-pa-md"},{default:l(()=>[a(Ee,{class:"q-pa-md",terceroData:I.value,isDialogActivado:!0,onTerceroGuardado:le},null,8,["terceroData"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(j,{modelValue:T.value,"onUpdate:modelValue":e[15]||(e[15]=o=>T.value=o),maximized:"","full-width":""},{default:l(()=>[a(M,{style:{width:"800px","max-width":"90vw"}},{default:l(()=>[a(J,{class:"bg-blue-grey-9 text-white"},{default:l(()=>[a(K,null,{default:l(()=>[...e[22]||(e[22]=[m(" Pqrs ",-1)])]),_:1}),U((x(),E(b,{flat:"",icon:"close"},{default:l(()=>[a(A,{"content-class":"bg-white text-primary"},{default:l(()=>[...e[23]||(e[23]=[m("Cerrar",-1)])]),_:1})]),_:1})),[[S]])]),_:1}),a(L,{class:"q-pa-md"},{default:l(()=>[a(Ne,{class:"q-pa-md",terceroData:I.value,isDialogActivado:!0,onEditarPqrs:oe},null,8,["terceroData"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])])]),_:1}))}};export{sa as default};
