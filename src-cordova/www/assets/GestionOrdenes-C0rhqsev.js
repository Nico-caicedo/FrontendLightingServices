import{r as u,c as ue,o as ce,k as p,l as i,m as a,n as l,f as t,t as Y,x as v,S as f,a0 as b,Z as g,_ as d,a4 as Z,Q as y,p as C,y as n,V as x,F as T,W as L,X as H,ab as P,a2 as me,aw as pe}from"./index-DD84rciS.js";import{Q as ve}from"./QSelect-D9KbhcM8.js";import{Q as $}from"./QList-BWY4JASi.js";import{Q as fe,a as k}from"./QItemLabel-Y1e7J-9n.js";import{Q as be}from"./QTd-Bq4iPcoX.js";import{Q as ge}from"./QTable-B6mhboVn.js";import{Q as J,a as K}from"./QToolbar-CvcB6vS-.js";import{Q as h}from"./QMarkupTable-DvZ2xV1r.js";import{Q as ee}from"./QImg-DKGqs6TN.js";import{Q as ye}from"./QExpansionItem-CKH_igge.js";import{Q as Ce}from"./QPage-BB2Um8dJ.js";import{C as q}from"./ClosePopup-CT1KP1o0.js";import{u as xe}from"./use-quasar-CoRWwBkt.js";import{U as O}from"./Utils-DJ7xQ2GR.js";import{api as S}from"./axios-DO-4OFiN.js";import"./format-DyQxkAtJ.js";import"./QVirtualScroll-DljW3BAz.js";import"./QSlideTransition-WkxNlc5h.js";const qe={class:"bg-white row full q-gutter-sm q-pa-sm q-ma-sm"},Ve={class:"q-pa-sm bg-grey-2 rounded-borders q-mb-md"},ke={class:"row q-col-gutter-md"},we={class:"col-12 col-md-6"},Qe={class:"col-12 col-md-6"},Ee={class:"q-pa-md"},Te={class:"row q-col-gutter-md q-mb-md"},Le={class:"col-12 col-md-6"},Oe={class:"col-12 col-md-6"},De={class:"q-mt-md"},Ne={class:"q-pa-md evidencias-container"},je={class:"row q-col-gutter-md justify-center"},Ie={class:"absolute-bottom bg-black bg-opacity-40 text-white text-center q-pa-xs text-caption truncate"},Me={class:"q-mt-md"},_e={class:"q-pa-md evidencias-container"},$e={class:"row q-col-gutter-md justify-center"},Ue={class:"absolute-bottom bg-black bg-opacity-40 text-white text-center q-pa-xs text-caption truncate"},Fe={class:"q-gutter-y-sm"},Pe={align:"center"},nl={__name:"GestionOrdenes",setup(Se){const D=xe(),A=u([]),R=u([]),N=u(!1);u({});const U=u(""),j=u(null),I=u(!1),le=u({}),w=u({}),F=u({}),c=u({}),Q=u([]);u(null);const M=u(""),te=[{name:"Codigo",label:"Código Radicado",field:"CodigoRadicado",align:"center",sortable:!0},{name:"Tecnico",label:"Técnico",field:"UsuarioTecnico",align:"center"},{name:"Fecha",label:"Fecha Creación",field:"FechaRadicado",align:"center",format:o=>O.formatearFecha(o)},{name:"FechaEjecucion",label:"Fecha Ejecución",field:"FechaEjecucion",align:"center",format:o=>O.formatearFecha(o)},{name:"Estado",label:"Estado",field:"EstadoSolicitud",align:"center",format:o=>{switch(o){case 3:return"En validación";case 4:return"Devuelto";default:return"Desconocido"}}},{name:"acciones",label:"Acciones",align:"center"}],ae=async()=>{console.log(w.value);const o=await S.get(`/ordenservicio/${w.value.IdEmpresa}/traer-ordenes-empresa`);R.value=o.data},B=o=>{pe.create({message:`<img src="${o.Ruta}" style="width: 90%;  border-radius: 8px;" />`,html:!0,persistent:!0})},oe=async()=>{const o={IdPqrs:c.value.IdPqrs,IdTecnico:c.value.IdUsuarioTecnico,IdSupervisor:w.value.IdUsuario,Observacion:M.value},e=await S.post("/ordenservicio/guardar-observacion-orden",o);console.log(e),re(),O.notificacion(e.data.Mensaje,e.data.IsExito),O.loadingNotify(!1,"")},re=()=>{I.value=!1,N.value=!1,M.value="",F.value={},c.value={},Q.value=[]},ne=ue(()=>R.value.filter(o=>{const e=o.CodigoRadicado.toLowerCase().includes(U.value.toLowerCase()),s=!j.value||o.Estado===j.value;return e&&s})),se=async o=>{le.value=o,I.value=!0;const e=await S.post(`/ordenservicio/${w.value.IdEmpresa}/${o.IdPqrs}/traer-info-orden`);console.log(e);const s=e.data.Dato;F.value=s.Actividades,c.value=s.InfoPqrs,Q.value=s.Materiales,A.value=s.Evidencias},ie=o=>{D.dialog({title:"Aprobar orden",message:`¿Deseas aprobar la orden ${o.Codigo}?`,cancel:!0,persistent:!0}).onOk(()=>{o.Estado="Aprobada",D.notify({message:"Orden aprobada correctamente",color:"green",icon:"check"})})},de=o=>{D.dialog({title:"Devolver orden",message:`¿Deseas devolver la orden ${o.Codigo} al técnico?`,cancel:!0,persistent:!0}).onOk(()=>{o.Estado="Devuelta",D.notify({message:"Orden devuelta al técnico",color:"red",icon:"undo"})})};return ce(async()=>{try{const o=await O.datoUsuario();if(!o){router.push("/Login");return}w.value=o}catch(o){console.error(o)}ae()}),(o,e)=>(i(),p(Ce,{class:"q-pa-md bg-grey-2"},{default:a(()=>[e[41]||(e[41]=l("div",{class:"text-h5 text-primary q-mb-md"}," Gestión de Órdenes de Servicio ",-1)),l("div",qe,[t(Y,{modelValue:U.value,"onUpdate:modelValue":e[0]||(e[0]=s=>U.value=s),label:"Buscar por código o técnico",dense:"",clearable:"",outlined:""},null,8,["modelValue"]),t(ve,{modelValue:j.value,"onUpdate:modelValue":e[1]||(e[1]=s=>j.value=s),options:["Pendiente","En validación","Aprobada","Devuelta"],label:"Filtrar por estado",dense:"",clearable:"",outlined:""},null,8,["modelValue"])]),t(ge,{title:"Órdenes registradas",rows:ne.value,columns:te,"row-key":"IdOrden",flat:"",bordered:"",dense:""},{"body-cell-acciones":a(s=>[t(be,{align:"center"},{default:a(()=>[t(v,{flat:"",round:"",dense:"",icon:"view_headline"},{default:a(()=>[t(fe,null,{default:a(()=>[t($,{style:{"min-width":"100px"}},{default:a(()=>[f((i(),p(b,{clickable:"",onClick:E=>se(s.row)},{default:a(()=>[t(g,null,{default:a(()=>[...e[6]||(e[6]=[d("Ver Orden",-1)])]),_:1})]),_:2},1032,["onClick"])),[[q]]),f((i(),p(b,{clickable:"",onClick:E=>ie(s.row)},{default:a(()=>[t(g,null,{default:a(()=>[...e[7]||(e[7]=[d("Aprobar Orden",-1)])]),_:1})]),_:2},1032,["onClick"])),[[q]]),f((i(),p(b,{clickable:"",onClick:E=>de(s.row)},{default:a(()=>[t(g,null,{default:a(()=>[...e[8]||(e[8]=[d("Devolver Orden",-1)])]),_:1})]),_:2},1032,["onClick"])),[[q]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["rows"]),t(Z,{modelValue:I.value,"onUpdate:modelValue":e[5]||(e[5]=s=>I.value=s),maximized:"","full-width":""},{default:a(()=>[t(y,{style:{"min-width":"400px"}},{default:a(()=>[t(J,{class:"bg-blue-grey-9 text-white"},{default:a(()=>[t(K,null,{default:a(()=>[...e[9]||(e[9]=[d("Detalles de la Orden",-1)])]),_:1}),f(t(v,{flat:"",round:"",dense:"",icon:"close",onClick:o.VaciarObservacion},null,8,["onClick"]),[[q]])]),_:1}),t(C,null,{default:a(()=>{var s,E,z,G,W,X;return[l("div",Ve,[e[16]||(e[16]=l("div",{class:"text-h6 text-primary q-mb-sm"},"Información del PQRS",-1)),l("div",ke,[l("div",we,[l("p",null,[e[10]||(e[10]=l("b",null,"Código Radicado:",-1)),d(" "+n((s=c.value)==null?void 0:s.CodigoRadicado),1)]),l("p",null,[e[11]||(e[11]=l("b",null,"Código Documento:",-1)),d(" "+n((E=c.value)==null?void 0:E.CodigoDocumento),1)]),l("p",null,[e[12]||(e[12]=l("b",null,"Barrio:",-1)),d(" "+n((z=c.value)==null?void 0:z.NombreBarrio),1)])]),l("div",Qe,[l("p",null,[e[13]||(e[13]=l("b",null,"Nombre:",-1)),d(" "+n((G=c.value)==null?void 0:G.NombreCompleto),1)]),l("p",null,[e[14]||(e[14]=l("b",null,"Dirección:",-1)),d(" "+n((W=c.value)==null?void 0:W.Direccion),1)]),l("p",null,[e[15]||(e[15]=l("b",null,"Correo:",-1)),d(" "+n((X=c.value)==null?void 0:X.Correo),1)])])])]),l("div",Ee,[e[36]||(e[36]=l("div",{class:"text-h6 text-primary q-mb-md"},"Lista de Actividades",-1)),t($,{bordered:"",separator:""},{default:a(()=>[(i(!0),x(T,null,L(F.value,(r,V)=>(i(),p(ye,{key:V,"expand-separator":"",icon:"engineering",label:r.TipoOperacion,caption:`Tipo Trabajo: ${r.TipoTrabajo} | Vieja: ${r.CodigoLuminariaVieja}  |  Nueva: ${r.CodigoLuminariaNueva}`,"header-class":"bg-grey-2 text-primary text-bold"},{default:a(()=>[t(y,{flat:"",bordered:"",class:"q-mt-sm q-pa-sm bg-grey-1"},{default:a(()=>[t(C,null,{default:a(()=>[l("div",Te,[l("div",Le,[t(y,{flat:"",bordered:""},{default:a(()=>[t(C,{class:"bg-grey-3"},{default:a(()=>[...e[17]||(e[17]=[l("div",{class:"text-subtitle1 text-primary text-center"}," Luminaria Vieja ",-1)])]),_:1}),t(h,{flat:"",dense:"",separator:"cell"},{default:a(()=>[l("tbody",null,[l("tr",null,[e[18]||(e[18]=l("td",null,"Código",-1)),l("td",null,n(r.CodigoLuminariaVieja),1)]),l("tr",null,[e[19]||(e[19]=l("td",null,"Clase",-1)),l("td",null,n(r.ClaseLuminariaVieja),1)]),l("tr",null,[e[20]||(e[20]=l("td",null,"Tipo",-1)),l("td",null,n(r.TipoLuminariaVieja),1)]),l("tr",null,[e[21]||(e[21]=l("td",null,"Potencia",-1)),l("td",null,n(r.TipoPotenciaVieja),1)]),l("tr",null,[e[22]||(e[22]=l("td",null,"Marca",-1)),l("td",null,n(r.MarcaLuminariaVieja),1)]),l("tr",null,[e[23]||(e[23]=l("td",null,"Estado",-1)),l("td",null,n(r.EstadoLuminariaVieja),1)]),l("tr",null,[e[24]||(e[24]=l("td",null,"Verificación",-1)),l("td",null,n(r.VerificacionVieja),1)])])]),_:2},1024)]),_:2},1024)]),l("div",Oe,[t(y,{flat:"",bordered:""},{default:a(()=>[t(C,{class:"bg-grey-3"},{default:a(()=>[...e[25]||(e[25]=[l("div",{class:"text-subtitle1 text-positive text-center"}," Luminaria Nueva ",-1)])]),_:1}),t(h,{flat:"",dense:"",separator:"cell"},{default:a(()=>[l("tbody",null,[l("tr",null,[e[26]||(e[26]=l("td",null,"Código",-1)),l("td",null,n(r.CodigoLuminariaNueva),1)]),l("tr",null,[e[27]||(e[27]=l("td",null,"Clase",-1)),l("td",null,n(r.ClaseLuminariaNueva),1)]),l("tr",null,[e[28]||(e[28]=l("td",null,"Tipo",-1)),l("td",null,n(r.TipoLuminariaNueva),1)]),l("tr",null,[e[29]||(e[29]=l("td",null,"Potencia",-1)),l("td",null,n(r.TipoPotenciaNueva),1)]),l("tr",null,[e[30]||(e[30]=l("td",null,"Marca",-1)),l("td",null,n(r.MarcaLuminariaNueva),1)]),l("tr",null,[e[31]||(e[31]=l("td",null,"Estado",-1)),l("td",null,n(r.EstadoLuminariaNueva),1)]),l("tr",null,[e[32]||(e[32]=l("td",null,"Verificación",-1)),l("td",null,n(r.VerificacionNueva),1)])])]),_:2},1024)]),_:2},1024)])])]),_:2},1024),t(C,null,{default:a(()=>[l("div",De,[e[34]||(e[34]=l("div",{class:"text-h6 text-primary q-mb-sm col-8 col-sm-3 col-md-4 col-lg-3"}," Materiales Utilizados ",-1)),t($,{bordered:"",separator:"",class:"rounded-borders bg-grey-1"},{default:a(()=>[(i(!0),x(T,null,L(r.Materiales,(m,_)=>(i(),p(b,{key:_},{default:a(()=>[t(g,null,{default:a(()=>[t(k,null,{default:a(()=>[l("b",null,n(m.Material),1)]),_:2},1024),t(k,{caption:""},{default:a(()=>[d(" Cantidad: "+n(m.CantidadMaterial)+" "+n(m.Unidad)+" — "+n(m.Tipo),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),!r.Materiales||!r.Materiales.length?(i(),p(b,{key:0},{default:a(()=>[t(g,null,{default:a(()=>[t(k,{class:"text-grey"},{default:a(()=>[...e[33]||(e[33]=[d("No se registraron materiales.",-1)])]),_:1})]),_:1})]),_:1})):H("",!0)]),_:2},1024)])]),_:2},1024),t(C,null,{default:a(()=>[l("div",Ne,[e[35]||(e[35]=l("div",{class:"text-h6 text-weight-bold text-primary q-mb-lg text-center"}," Lista de Evidencias ",-1)),l("div",je,[(i(!0),x(T,null,L(r.Evidencias,(m,_)=>(i(),x("div",{key:_,class:"col-10 col-sm-3 col-md-3 col-lg-3"},[t(y,{flat:"",bordered:"",class:"hover-card column items-center q-pa-sm"},{default:a(()=>[t(ee,{src:m.Ruta,ratio:"1","spinner-color":"primary",class:"rounded-borders shadow-1"},{default:a(()=>[l("div",Ie,n(m.Nombre||`Evidencia ${_+1}`),1)]),_:2},1032,["src"]),t(P,{align:"center",class:"q-mt-xs"},{default:a(()=>[t(v,{flat:"",color:"primary",icon:"visibility",label:"Ver",class:"btn-ver",onClick:Ae=>B(m)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])])]),_:2},1024)]),_:2},1024)]),_:2},1032,["label","caption"]))),128))]),_:1})]),l("div",Me,[e[38]||(e[38]=l("div",{class:"text-h6 text-primary q-mb-sm col-8 col-sm-3 col-md-4 col-lg-3"},"Materiales Utilizados ",-1)),t($,{bordered:"",separator:"",class:"rounded-borders bg-grey-1"},{default:a(()=>[(i(!0),x(T,null,L(Q.value,(r,V)=>(i(),p(b,{key:V},{default:a(()=>[t(g,null,{default:a(()=>[t(k,null,{default:a(()=>[l("b",null,n(r.Material),1)]),_:2},1024),t(k,{caption:""},{default:a(()=>[d(" Cantidad: "+n(r.CantidadMaterial)+" "+n(r.Unidad)+" — "+n(r.Tipo),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),!Q.value||!Q.value.length?(i(),p(b,{key:0},{default:a(()=>[t(g,null,{default:a(()=>[t(k,{class:"text-grey"},{default:a(()=>[...e[37]||(e[37]=[d("No se registraron materiales.",-1)])]),_:1})]),_:1})]),_:1})):H("",!0)]),_:1})]),l("div",_e,[e[39]||(e[39]=l("div",{class:"text-h6 text-weight-bold text-primary q-mb-lg text-center"}," Lista de Evidencias ",-1)),l("div",$e,[(i(!0),x(T,null,L(A.value,(r,V)=>(i(),x("div",{key:V,class:"col-10 col-sm-3 col-md-3 col-lg-3"},[t(y,{flat:"",bordered:"",class:"hover-card column items-center q-pa-sm"},{default:a(()=>[t(ee,{src:r.Ruta,ratio:"1","spinner-color":"primary",class:"rounded-borders shadow-1"},{default:a(()=>[l("div",Ue,n(r.Nombre||`Evidencia ${V+1}`),1)]),_:2},1032,["src"]),t(P,{align:"center",class:"q-mt-xs"},{default:a(()=>[t(v,{flat:"",color:"primary",icon:"visibility",label:"Ver",class:"btn-ver",onClick:m=>B(r)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])])]}),_:1}),t(me),t(P,{class:"q-gutter-sm",align:"right"},{default:a(()=>[f(t(v,{label:"Aprobar Y finalizar",icon:"check",color:"green"},null,512),[[q]]),t(v,{label:"devolver para correción",icon:"undo",color:"red",onClick:e[2]||(e[2]=s=>N.value=!0)}),f(t(v,{label:"Cerrar",color:"grey"},null,512),[[q]])]),_:1}),t(Z,{modelValue:N.value,"onUpdate:modelValue":e[4]||(e[4]=s=>N.value=s),style:{"min-width":"400px"}},{default:a(()=>[t(y,{style:{"min-width":"400px"}},{default:a(()=>[t(J,{class:"bg-blue-grey-9 text-white"},{default:a(()=>[t(K,null,{default:a(()=>[...e[40]||(e[40]=[d("Observacion devolución orden",-1)])]),_:1}),f(t(v,{flat:"",round:"",dense:"",icon:"close",onClick:o.VaciarObservacion},null,8,["onClick"]),[[q]])]),_:1}),t(C,{"leave-class":""},{default:a(()=>[l("div",Fe,[t(Y,{type:"textarea",label:"Observación Orden...",modelValue:M.value,"onUpdate:modelValue":e[3]||(e[3]=s=>M.value=s)},null,8,["modelValue"]),l("div",Pe,[t(v,{label:"Ejecutar devolución",icon:"undo",color:"green",onClick:oe})])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{nl as default};
